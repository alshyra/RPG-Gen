FROM node:25.2.0-alpine3.22 AS base_node
FROM base_node AS builder

COPY packages/backend /app/backend
COPY packages/shared /app/shared

WORKDIR /app/backend

RUN cd /app/backend &&\
    npm ci && \
    npm run build && \
    npm prune --production

FROM base_node

WORKDIR /app/backend

COPY --from=builder /app/ /app

EXPOSE 3001

CMD ["npm", "run", "start"]
