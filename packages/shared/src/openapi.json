{
  "openapi": "3.0.0",
  "paths": {
    "/api/auth/google": {
      "get": {
        "operationId": "AuthController_googleAuth",
        "parameters": [],
        "responses": {
          "200": {
            "description": ""
          }
        },
        "summary": "Initiate Google OAuth login",
        "tags": [
          "auth"
        ]
      }
    },
    "/api/auth/google/callback": {
      "get": {
        "operationId": "AuthController_googleAuthRedirect",
        "parameters": [],
        "responses": {
          "200": {
            "description": ""
          }
        },
        "summary": "Google OAuth callback",
        "tags": [
          "auth"
        ]
      }
    },
    "/api/auth/profile": {
      "get": {
        "operationId": "AuthController_getProfile",
        "parameters": [],
        "responses": {
          "200": {
            "description": "List of characters",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthProfileDto"
                }
              }
            }
          }
        },
        "summary": "Get current user profile",
        "tags": [
          "auth"
        ]
      }
    },
    "/api/auth/logout": {
      "get": {
        "operationId": "AuthController_logout",
        "parameters": [],
        "responses": {
          "200": {
            "description": ""
          }
        },
        "summary": "Logout (client should clear token)",
        "tags": [
          "auth"
        ]
      }
    },
    "/api/chat/{characterId}": {
      "post": {
        "operationId": "ChatController_chat",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ChatMessageDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Chat message (assistant) with narrative and instructions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ChatMessageDto"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request"
          },
          "500": {
            "description": "Chat processing failed"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Send prompt to Gemini (chat)",
        "tags": [
          "chat"
        ]
      }
    },
    "/api/chat/{characterId}/history": {
      "get": {
        "operationId": "ChatController_getHistory",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Conversation history",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ChatMessageDto"
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request"
          },
          "500": {
            "description": "History retrieval failed"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Get conversation history for a character",
        "tags": [
          "chat"
        ]
      }
    },
    "/api/characters": {
      "post": {
        "operationId": "CharacterController_create",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateCharacterBodyDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Character created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CharacterResponseDto"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Create a new character",
        "tags": [
          "characters"
        ]
      },
      "get": {
        "operationId": "CharacterController_findAll",
        "parameters": [],
        "responses": {
          "200": {
            "description": "List of characters",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/CharacterResponseDto"
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Get all characters for the current user",
        "tags": [
          "characters"
        ]
      }
    },
    "/api/characters/deceased": {
      "get": {
        "operationId": "CharacterController_getDeceased",
        "parameters": [],
        "responses": {
          "200": {
            "description": "List of deceased characters",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/DeceasedCharacterResponseDto"
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Get all deceased characters",
        "tags": [
          "characters"
        ]
      }
    },
    "/api/characters/{characterId}": {
      "get": {
        "operationId": "CharacterController_findOne",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Character found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CharacterResponseDto"
                }
              }
            }
          },
          "404": {
            "description": "Character not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Get a specific character by ID",
        "tags": [
          "characters"
        ]
      },
      "put": {
        "operationId": "CharacterController_update",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "description": "ID of the character to update",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "description": "Fields to update",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateCharacterRequestDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Character updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CharacterResponseDto"
                }
              }
            }
          },
          "404": {
            "description": "Character not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Update a character",
        "tags": [
          "characters"
        ]
      },
      "delete": {
        "operationId": "CharacterController_delete",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Character deleted",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            }
          },
          "404": {
            "description": "Character not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Delete a character",
        "tags": [
          "characters"
        ]
      }
    },
    "/api/characters/{characterId}/kill": {
      "post": {
        "operationId": "CharacterController_kill",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/KillCharacterBodyDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Character marked as deceased",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CharacterResponseDto"
                }
              }
            }
          },
          "404": {
            "description": "Character not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Mark a character as deceased",
        "tags": [
          "characters"
        ]
      }
    },
    "/api/characters/{characterId}/inventory": {
      "post": {
        "operationId": "CharacterController_addInventory",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateInventoryItemDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Item added to inventory",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CharacterResponseDto"
                }
              }
            }
          },
          "404": {
            "description": "Character not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Add an item to character's inventory",
        "tags": [
          "characters"
        ]
      }
    },
    "/api/characters/{characterId}/inventory/equip": {
      "post": {
        "operationId": "CharacterController_equipInventory",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/EquipInventoryDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Character updated with equipped item",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CharacterResponseDto"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Equip an item by definitionId (weapon only)",
        "tags": [
          "characters"
        ]
      }
    },
    "/api/characters/{characterId}/inventory/{itemId}": {
      "patch": {
        "operationId": "CharacterController_updateInventory",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "itemId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateInventoryItemDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Inventory item updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CharacterResponseDto"
                }
              }
            }
          },
          "404": {
            "description": "Character or item not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Update an item in character's inventory",
        "tags": [
          "characters"
        ]
      },
      "delete": {
        "operationId": "CharacterController_removeInventory",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "itemId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RemoveInventoryBodyDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Item removed from inventory",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CharacterResponseDto"
                }
              }
            }
          },
          "404": {
            "description": "Character or item not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Remove an item from character's inventory",
        "tags": [
          "characters"
        ]
      }
    },
    "/api/characters/{characterId}/inspiration/grant": {
      "post": {
        "operationId": "CharacterController_grantInspiration",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/GrantInspirationBodyDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Inspiration granted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/InspirationResponseDto"
                }
              }
            }
          },
          "400": {
            "description": "Invalid amount"
          },
          "404": {
            "description": "Character not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Grant inspiration point(s) to a character",
        "tags": [
          "characters"
        ]
      }
    },
    "/api/characters/{characterId}/inspiration/spend": {
      "post": {
        "operationId": "CharacterController_spendInspiration",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "201": {
            "description": "Inspiration spent",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/InspirationResponseDto"
                }
              }
            }
          },
          "400": {
            "description": "No inspiration points available"
          },
          "404": {
            "description": "Character not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Spend an inspiration point",
        "tags": [
          "characters"
        ]
      }
    },
    "/api/combat/{characterId}/start": {
      "post": {
        "operationId": "CombatController_startCombat",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CombatStartRequestDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CombatStateDto"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Initialize combat with enemies",
        "tags": [
          "combat"
        ]
      }
    },
    "/api/combat/{characterId}/attack": {
      "post": {
        "operationId": "CombatController_attack",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AttackRequestDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AttackResponseDto"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Execute player attack in combat, determine if player hit his target",
        "tags": [
          "combat"
        ]
      }
    },
    "/api/combat/{characterId}/status": {
      "get": {
        "operationId": "CombatController_getStatus",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CombatStateDto"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Get current combat status",
        "tags": [
          "combat"
        ]
      }
    },
    "/api/combat/{characterId}/end-turn": {
      "post": {
        "operationId": "CombatController_endTurn",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Returns attack logs for animations and new player turn state",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EndPlayerTurnResponseDto"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "End current player activation and advance turn (triggers enemy actions)",
        "tags": [
          "combat"
        ]
      }
    },
    "/api/combat/{characterId}/flee": {
      "post": {
        "operationId": "CombatController_flee",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CombatEndResponseDto"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Force end current combat (flee)",
        "tags": [
          "combat"
        ]
      }
    },
    "/api/dice": {
      "post": {
        "operationId": "DiceController_roll",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DiceRequestDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Dice throw result",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DiceResultDto"
                }
              }
            }
          },
          "400": {
            "description": "Invalid dice expression"
          }
        },
        "summary": "Roll dice expression like 1d6+2, optionally with advantage/disadvantage for d20",
        "tags": [
          "dice"
        ]
      }
    },
    "/api/image": {
      "post": {
        "operationId": "ImageController_generate",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ImageRequestDto"
              }
            }
          }
        },
        "responses": {
          "400": {
            "description": "Image generation not implemented"
          }
        },
        "summary": "Generate image from prompt",
        "tags": [
          "image"
        ]
      }
    },
    "/api/image/generate-avatar": {
      "post": {
        "operationId": "ImageController_generateAvatar",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CharacterIdBodyDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Avatar generated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AvatarResponseDto"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request or avatar generation failed"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Generate character avatar from description",
        "tags": [
          "image"
        ]
      }
    },
    "/api/health": {
      "get": {
        "operationId": "HealthController_getHealth",
        "parameters": [],
        "responses": {
          "200": {
            "description": ""
          }
        },
        "tags": [
          "Health"
        ]
      }
    },
    "/api/characters/{characterId}/inventory/use": {
      "post": {
        "operationId": "InventoryController_useItem",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "description": "Character ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UseItemRequestDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Item used successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UseItemResponseDto"
                }
              }
            }
          },
          "400": {
            "description": "Bad request (item not found, wrong context, etc.)"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Use an item from inventory",
        "tags": [
          "inventory"
        ]
      }
    },
    "/api/rolls/{characterId}": {
      "post": {
        "operationId": "RollsController_submitRoll",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SubmitRollDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/RollInstructionMessageDto"
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Submit resolved roll(s) (non-chat) for processing",
        "tags": [
          "rolls"
        ]
      }
    }
  },
  "info": {
    "title": "RPG Gemini Portal",
    "description": "Prototype API for RPG portal using Gemini tokens",
    "version": "0.1",
    "contact": {}
  },
  "tags": [],
  "servers": [],
  "components": {
    "securitySchemes": {
      "bearer": {
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "type": "http"
      }
    },
    "schemas": {
      "AuthProfileDto": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "Id de l'utilisateur"
          },
          "email": {
            "type": "string",
            "description": "Email de l'utilisateur"
          },
          "displayName": {
            "type": "string",
            "description": "Nom affich√© de l'utilisateur"
          },
          "picture": {
            "type": "string",
            "description": "URL de la photo de profil de l'utilisateur"
          }
        },
        "required": [
          "id",
          "email",
          "displayName",
          "picture"
        ]
      },
      "RollMetaDto": {
        "type": "object",
        "properties": {
          "attackBonus": {
            "type": "number",
            "description": "Attack bonus to apply"
          },
          "target": {
            "type": "string",
            "description": "Target name"
          },
          "targetAc": {
            "type": "number",
            "description": "Target armor class"
          },
          "damageDice": {
            "type": "string",
            "description": "Damage dice expression"
          },
          "damageBonus": {
            "type": "number",
            "description": "Damage bonus to apply"
          },
          "action": {
            "type": "string",
            "description": "Action type (e.g., attack, damage)"
          }
        }
      },
      "RollInstructionMessageDto": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "description": "Instruction type",
            "enum": [
              "roll"
            ]
          },
          "dices": {
            "type": "string",
            "description": "Dice expression (e.g., 1d20+5)"
          },
          "modifierLabel": {
            "type": "string",
            "description": "Semantic modifier label (e.g., \"wisdom (Perception)\")"
          },
          "modifierValue": {
            "type": "number",
            "description": "Numeric modifier to apply to the roll (e.g., +3)"
          },
          "description": {
            "type": "string",
            "description": "Roll description"
          },
          "advantage": {
            "type": "string",
            "description": "Advantage type",
            "enum": [
              "advantage",
              "disadvantage",
              "none"
            ]
          },
          "meta": {
            "description": "Optional metadata for combat rolls",
            "allOf": [
              {
                "$ref": "#/components/schemas/RollMetaDto"
              }
            ]
          }
        },
        "required": [
          "type",
          "dices"
        ]
      },
      "HpInstructionMessageDto": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "description": "Instruction type",
            "enum": [
              "hp"
            ]
          },
          "hp": {
            "type": "number",
            "description": "Amount of HP change"
          }
        },
        "required": [
          "type",
          "hp"
        ]
      },
      "XpInstructionMessageDto": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "description": "Instruction type",
            "enum": [
              "xp"
            ]
          },
          "xp": {
            "type": "number",
            "description": "Amount of XP gained"
          }
        },
        "required": [
          "type",
          "xp"
        ]
      },
      "SpellInstructionMessageDto": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "description": "Instruction type",
            "enum": [
              "spell"
            ]
          },
          "action": {
            "type": "string",
            "description": "Spell action",
            "enum": [
              "learn",
              "cast",
              "forget"
            ]
          },
          "name": {
            "type": "string",
            "description": "Spell name"
          },
          "level": {
            "type": "number",
            "description": "Spell level"
          },
          "school": {
            "type": "string",
            "description": "Spell school"
          },
          "description": {
            "type": "string",
            "description": "Spell description"
          }
        },
        "required": [
          "type",
          "action",
          "name"
        ]
      },
      "InventoryInstructionMessageDto": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "description": "Instruction type",
            "enum": [
              "inventory"
            ]
          },
          "action": {
            "type": "string",
            "description": "Inventory action",
            "enum": [
              "add",
              "remove",
              "use"
            ]
          },
          "name": {
            "type": "string",
            "description": "Item name"
          },
          "itemId": {
            "type": "string",
            "description": "Inventory item _id (required for use action)"
          },
          "quantity": {
            "type": "number",
            "description": "Quantity"
          },
          "description": {
            "type": "string",
            "description": "Item description"
          }
        },
        "required": [
          "type",
          "action",
          "name"
        ]
      },
      "CombatStartEntryDto": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Enemy name"
          },
          "hp": {
            "type": "number",
            "description": "Enemy HP"
          },
          "ac": {
            "type": "number",
            "description": "Enemy AC"
          },
          "attack_bonus": {
            "type": "number",
            "description": "Attack bonus (optional)"
          },
          "damage_dice": {
            "type": "string",
            "description": "Damage dice (optional)"
          },
          "damage_bonus": {
            "type": "number",
            "description": "Damage bonus (optional)"
          }
        },
        "required": [
          "name",
          "hp",
          "ac"
        ]
      },
      "CombatStartInstructionMessageDto": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "description": "Instruction type",
            "enum": [
              "combat_start"
            ]
          },
          "combat_start": {
            "description": "Combat start entries",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CombatStartEntryDto"
            }
          }
        },
        "required": [
          "type",
          "combat_start"
        ]
      },
      "ChatMessageDto": {
        "type": "object",
        "properties": {
          "role": {
            "type": "string",
            "description": "Message role",
            "enum": [
              "user",
              "assistant",
              "system"
            ]
          },
          "narrative": {
            "type": "string",
            "description": "Narrative text (for assistant messages)"
          },
          "instructions": {
            "type": "array",
            "description": "Game instructions (for assistant messages)",
            "items": {
              "oneOf": [
                {
                  "$ref": "#/components/schemas/RollInstructionMessageDto"
                },
                {
                  "$ref": "#/components/schemas/HpInstructionMessageDto"
                },
                {
                  "$ref": "#/components/schemas/XpInstructionMessageDto"
                },
                {
                  "$ref": "#/components/schemas/SpellInstructionMessageDto"
                },
                {
                  "$ref": "#/components/schemas/InventoryInstructionMessageDto"
                },
                {
                  "$ref": "#/components/schemas/CombatStartInstructionMessageDto"
                }
              ]
            }
          }
        },
        "required": [
          "role",
          "narrative"
        ]
      },
      "CreateCharacterBodyDto": {
        "type": "object",
        "properties": {
          "world": {
            "type": "string",
            "description": "Game world (e.g., dnd, vtm)"
          }
        },
        "required": [
          "world"
        ]
      },
      "RaceResponseDto": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "Race ID"
          },
          "name": {
            "type": "string",
            "description": "Race name"
          },
          "mods": {
            "type": "object",
            "description": "Ability score modifiers",
            "additionalProperties": {
              "type": "number"
            }
          }
        },
        "required": [
          "mods"
        ]
      },
      "AbilityScoresResponseDto": {
        "type": "object",
        "properties": {
          "Str": {
            "type": "number",
            "description": "Strength score"
          },
          "Dex": {
            "type": "number",
            "description": "Dexterity score"
          },
          "Con": {
            "type": "number",
            "description": "Constitution score"
          },
          "Int": {
            "type": "number",
            "description": "Intelligence score"
          },
          "Wis": {
            "type": "number",
            "description": "Wisdom score"
          },
          "Cha": {
            "type": "number",
            "description": "Charisma score"
          }
        }
      },
      "CharacterClassResponseDto": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Class name"
          },
          "level": {
            "type": "number",
            "description": "Class level"
          }
        }
      },
      "SkillResponseDto": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Skill name"
          },
          "proficient": {
            "type": "boolean",
            "description": "Is proficient in this skill"
          },
          "modifier": {
            "type": "number",
            "description": "Skill modifier"
          }
        }
      },
      "InventoryItemDto": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "description": "Item ID"
          },
          "definitionId": {
            "type": "string",
            "description": "Definition ID"
          },
          "name": {
            "type": "string",
            "description": "Item name"
          },
          "qty": {
            "type": "number",
            "description": "Quantity"
          },
          "description": {
            "type": "string",
            "description": "Item description"
          },
          "equipped": {
            "type": "boolean",
            "description": "Is equipped"
          },
          "meta": {
            "description": "Arbitrary item meta",
            "oneOf": [
              {
                "$ref": "#/components/schemas/WeaponMeta"
              },
              {
                "$ref": "#/components/schemas/ArmorMeta"
              },
              {
                "$ref": "#/components/schemas/ConsumableMeta"
              },
              {
                "$ref": "#/components/schemas/PackMeta"
              },
              {
                "$ref": "#/components/schemas/ToolMeta"
              }
            ]
          }
        }
      },
      "SpellResponseDto": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Spell name"
          },
          "level": {
            "type": "number",
            "description": "Spell level"
          },
          "description": {
            "type": "string",
            "description": "Spell description"
          },
          "meta": {
            "type": "object",
            "description": "Spell metadata",
            "additionalProperties": true
          }
        },
        "required": [
          "name"
        ]
      },
      "CharacterResponseDto": {
        "type": "object",
        "properties": {
          "characterId": {
            "type": "string",
            "description": "Unique character ID (UUID)"
          },
          "name": {
            "type": "string",
            "description": "Character name"
          },
          "physicalDescription": {
            "type": "string",
            "description": "Physical description of the character"
          },
          "race": {
            "description": "Character race",
            "allOf": [
              {
                "$ref": "#/components/schemas/RaceResponseDto"
              }
            ]
          },
          "scores": {
            "description": "Ability scores",
            "allOf": [
              {
                "$ref": "#/components/schemas/AbilityScoresResponseDto"
              }
            ]
          },
          "hp": {
            "type": "number",
            "description": "Current hit points"
          },
          "hpMax": {
            "type": "number",
            "description": "Maximum hit points"
          },
          "totalXp": {
            "type": "number",
            "description": "Total experience points"
          },
          "classes": {
            "description": "Character classes",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CharacterClassResponseDto"
            }
          },
          "skills": {
            "description": "Character skills",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SkillResponseDto"
            }
          },
          "world": {
            "type": "string",
            "description": "Game world (e.g., dnd, vtm)"
          },
          "portrait": {
            "type": "string",
            "description": "Character portrait URL or base64"
          },
          "gender": {
            "type": "string",
            "description": "Character gender"
          },
          "proficiency": {
            "type": "number",
            "description": "Proficiency bonus"
          },
          "inspirationPoints": {
            "type": "number",
            "description": "Inspiration points"
          },
          "isDeceased": {
            "type": "boolean",
            "description": "Whether character is deceased"
          },
          "diedAt": {
            "type": "string",
            "description": "Date of death (ISO string)"
          },
          "deathLocation": {
            "type": "string",
            "description": "Location where character died"
          },
          "state": {
            "type": "string",
            "description": "Character state",
            "enum": [
              "draft",
              "created"
            ]
          },
          "inventory": {
            "description": "Character inventory",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/InventoryItemDto"
            }
          },
          "spells": {
            "description": "Character spells",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SpellResponseDto"
            }
          }
        },
        "required": [
          "characterId",
          "world",
          "portrait",
          "isDeceased",
          "state"
        ]
      },
      "DeceasedCharacterResponseDto": {
        "type": "object",
        "properties": {
          "characterId": {
            "type": "string",
            "description": "Unique character ID (UUID)"
          },
          "name": {
            "type": "string",
            "description": "Character name"
          },
          "physicalDescription": {
            "type": "string",
            "description": "Physical description of the character"
          },
          "race": {
            "description": "Character race",
            "allOf": [
              {
                "$ref": "#/components/schemas/RaceResponseDto"
              }
            ]
          },
          "scores": {
            "description": "Ability scores",
            "allOf": [
              {
                "$ref": "#/components/schemas/AbilityScoresResponseDto"
              }
            ]
          },
          "hp": {
            "type": "number",
            "description": "Current hit points"
          },
          "hpMax": {
            "type": "number",
            "description": "Maximum hit points"
          },
          "totalXp": {
            "type": "number",
            "description": "Total experience points"
          },
          "classes": {
            "description": "Character classes",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CharacterClassResponseDto"
            }
          },
          "skills": {
            "description": "Character skills",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SkillResponseDto"
            }
          },
          "world": {
            "type": "string",
            "description": "Game world (e.g., dnd, vtm)"
          },
          "portrait": {
            "type": "string",
            "description": "Character portrait URL or base64"
          },
          "gender": {
            "type": "string",
            "description": "Character gender"
          },
          "proficiency": {
            "type": "number",
            "description": "Proficiency bonus"
          },
          "inspirationPoints": {
            "type": "number",
            "description": "Inspiration points"
          },
          "isDeceased": {
            "type": "boolean",
            "description": "Whether character is deceased"
          },
          "diedAt": {
            "type": "string",
            "description": "Date of death (ISO string)"
          },
          "deathLocation": {
            "type": "string",
            "description": "Location where character died"
          },
          "state": {
            "type": "string",
            "description": "Character state",
            "enum": [
              "draft",
              "created"
            ]
          },
          "inventory": {
            "description": "Character inventory",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/InventoryItemDto"
            }
          },
          "spells": {
            "description": "Character spells",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SpellResponseDto"
            }
          }
        },
        "required": [
          "characterId",
          "world",
          "portrait",
          "isDeceased",
          "state"
        ]
      },
      "UpdateCharacterRequestDto": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Character name"
          },
          "physicalDescription": {
            "type": "string",
            "description": "Physical description of the character"
          },
          "race": {
            "description": "Character race",
            "allOf": [
              {
                "$ref": "#/components/schemas/RaceResponseDto"
              }
            ]
          },
          "scores": {
            "description": "Ability scores",
            "allOf": [
              {
                "$ref": "#/components/schemas/AbilityScoresResponseDto"
              }
            ]
          },
          "hp": {
            "type": "number",
            "description": "Current hit points"
          },
          "hpMax": {
            "type": "number",
            "description": "Maximum hit points"
          },
          "totalXp": {
            "type": "number",
            "description": "Total experience points"
          },
          "classes": {
            "description": "Character classes",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CharacterClassResponseDto"
            }
          },
          "skills": {
            "description": "Character skills",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SkillResponseDto"
            }
          },
          "world": {
            "type": "string",
            "description": "Game world (e.g., dnd, vtm)"
          },
          "portrait": {
            "type": "string",
            "description": "Character portrait URL or base64"
          },
          "gender": {
            "type": "string",
            "description": "Character gender"
          },
          "proficiency": {
            "type": "number",
            "description": "Proficiency bonus"
          },
          "inspirationPoints": {
            "type": "number",
            "description": "Inspiration points"
          },
          "state": {
            "type": "string",
            "description": "Character state",
            "enum": [
              "draft",
              "created"
            ]
          },
          "inventory": {
            "description": "Character inventory",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/InventoryItemDto"
            }
          },
          "spells": {
            "description": "Character spells",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SpellResponseDto"
            }
          }
        }
      },
      "KillCharacterBodyDto": {
        "type": "object",
        "properties": {
          "deathLocation": {
            "type": "string",
            "description": "Location where character died"
          }
        }
      },
      "WeaponMeta": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "description": "Type discriminator for weapons",
            "enum": [
              "weapon"
            ]
          },
          "cost": {
            "type": "object",
            "description": "Item cost (gold pieces or formatted string)"
          },
          "weight": {
            "type": "object",
            "description": "Item weight in pounds"
          },
          "starter": {
            "type": "boolean",
            "description": "Whether this is a starter item"
          },
          "class": {
            "type": "string",
            "description": "Weapon class (e.g., Simple Melee, Martial Ranged)"
          },
          "damage": {
            "type": "string",
            "description": "Damage expression (e.g., 1d6 bludgeoning)"
          },
          "properties": {
            "description": "Weapon properties (e.g., Finesse, Thrown)",
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "ArmorMeta": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "description": "Type discriminator for armor",
            "enum": [
              "armor"
            ]
          },
          "cost": {
            "type": "object",
            "description": "Item cost (gold pieces or formatted string)"
          },
          "weight": {
            "type": "object",
            "description": "Item weight in pounds"
          },
          "starter": {
            "type": "boolean",
            "description": "Whether this is a starter item"
          },
          "class": {
            "type": "string",
            "description": "Armor class (Light, Medium, Heavy, Shield)"
          },
          "ac": {
            "type": "string",
            "description": "AC value (e.g., 11 + Dex modifier)"
          },
          "strength": {
            "type": "string",
            "description": "Strength requirement (e.g., Str 13)"
          },
          "stealth": {
            "type": "string",
            "description": "Stealth effect (e.g., Disadvantage)"
          }
        }
      },
      "ConsumableMeta": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "description": "Type discriminator for consumables",
            "enum": [
              "consumable"
            ]
          },
          "cost": {
            "type": "object",
            "description": "Item cost (gold pieces or formatted string)"
          },
          "weight": {
            "type": "object",
            "description": "Item weight in pounds"
          },
          "starter": {
            "type": "boolean",
            "description": "Whether this is a starter item"
          },
          "usable": {
            "type": "boolean",
            "description": "Whether the item can be used directly"
          },
          "combatUsable": {
            "type": "boolean",
            "description": "Whether the item can be used in combat (e.g., potions)"
          },
          "restUsable": {
            "type": "boolean",
            "description": "Whether the item can be used during rest (e.g., rations)"
          },
          "healDice": {
            "type": "string",
            "description": "Heal dice expression (e.g., \"2d4+2\")"
          }
        }
      },
      "PackMeta": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "description": "Type discriminator for packs",
            "enum": [
              "pack"
            ]
          },
          "cost": {
            "type": "object",
            "description": "Item cost (gold pieces or formatted string)"
          },
          "weight": {
            "type": "object",
            "description": "Item weight in pounds"
          },
          "starter": {
            "type": "boolean",
            "description": "Whether this is a starter item"
          }
        }
      },
      "ToolMeta": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "description": "Type discriminator for tools",
            "enum": [
              "tool"
            ]
          },
          "cost": {
            "type": "object",
            "description": "Item cost (gold pieces or formatted string)"
          },
          "weight": {
            "type": "object",
            "description": "Item weight in pounds"
          },
          "starter": {
            "type": "boolean",
            "description": "Whether this is a starter item"
          }
        }
      },
      "GenericMeta": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "description": "Item type discriminator"
          },
          "cost": {
            "type": "object",
            "description": "Item cost (gold pieces or formatted string)"
          },
          "weight": {
            "type": "object",
            "description": "Item weight in pounds"
          },
          "starter": {
            "type": "boolean",
            "description": "Whether this is a starter item"
          }
        }
      },
      "CreateInventoryItemDto": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "description": "Inventory item id (UUID). If provided, attempt to merge with existing item"
          },
          "definitionId": {
            "type": "string",
            "description": "Canonical definition id for this item"
          },
          "name": {
            "type": "string",
            "description": "Name for this inventory item"
          },
          "qty": {
            "type": "number",
            "description": "Quantity for this item"
          },
          "description": {
            "type": "string",
            "description": "Item description / notes"
          },
          "equipped": {
            "type": "boolean",
            "description": "If true this item is equipped"
          },
          "meta": {
            "description": "Arbitrary item meta",
            "oneOf": [
              {
                "$ref": "#/components/schemas/WeaponMeta"
              },
              {
                "$ref": "#/components/schemas/ArmorMeta"
              },
              {
                "$ref": "#/components/schemas/ConsumableMeta"
              },
              {
                "$ref": "#/components/schemas/PackMeta"
              },
              {
                "$ref": "#/components/schemas/ToolMeta"
              },
              {
                "$ref": "#/components/schemas/GenericMeta"
              }
            ]
          }
        },
        "required": [
          "definitionId"
        ]
      },
      "EquipInventoryDto": {
        "type": "object",
        "properties": {
          "definitionId": {
            "type": "string",
            "description": "Definition id of the item to equip",
            "example": "weapon-rapier"
          }
        },
        "required": [
          "definitionId"
        ]
      },
      "RemoveInventoryBodyDto": {
        "type": "object",
        "properties": {
          "qty": {
            "type": "number",
            "description": "Quantity to remove (-1 = remove all)"
          }
        }
      },
      "GrantInspirationBodyDto": {
        "type": "object",
        "properties": {
          "amount": {
            "type": "number",
            "description": "Amount of inspiration to grant (1-5)",
            "default": 1
          }
        }
      },
      "InspirationResponseDto": {
        "type": "object",
        "properties": {
          "ok": {
            "type": "boolean",
            "description": "Operation success status"
          },
          "inspirationPoints": {
            "type": "number",
            "description": "Updated inspiration points count"
          },
          "character": {
            "description": "Updated character",
            "allOf": [
              {
                "$ref": "#/components/schemas/CharacterResponseDto"
              }
            ]
          }
        },
        "required": [
          "ok",
          "inspirationPoints",
          "character"
        ]
      },
      "CombatStartRequestDto": {
        "type": "object",
        "properties": {
          "combat_start": {
            "description": "Array of enemies to initialize combat with",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CombatStartEntryDto"
            }
          }
        },
        "required": [
          "combat_start"
        ]
      },
      "CombatantDto": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "ID of the combatant (player character or enemy)"
          },
          "name": {
            "type": "string",
            "description": "Combatant name"
          },
          "initiative": {
            "type": "number",
            "description": "Initiative order value"
          },
          "isPlayer": {
            "type": "boolean",
            "description": "Whether combatant is player character"
          },
          "hp": {
            "type": "number",
            "description": "Current hit points (enemies only)"
          },
          "hpMax": {
            "type": "number",
            "description": "Maximum hit points (enemies only)"
          },
          "ac": {
            "type": "number",
            "description": "Armor class (enemies only)"
          },
          "attackBonus": {
            "type": "number",
            "description": "Enemy attack bonus (enemies only)"
          },
          "damageDice": {
            "type": "string",
            "description": "Enemy damage dice expression (enemies only), e.g. \"1d6\""
          },
          "damageBonus": {
            "type": "number",
            "description": "Enemy damage bonus (enemies only)"
          }
        },
        "required": [
          "id",
          "name",
          "initiative",
          "isPlayer"
        ]
      },
      "CombatStateDto": {
        "type": "object",
        "properties": {
          "characterId": {
            "type": "string",
            "description": "Character ID"
          },
          "inCombat": {
            "type": "boolean",
            "description": "Whether currently in combat"
          },
          "enemies": {
            "description": "Active enemies",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CombatantDto"
            }
          },
          "player": {
            "description": "Player state",
            "allOf": [
              {
                "$ref": "#/components/schemas/CombatantDto"
              }
            ]
          },
          "turnOrder": {
            "description": "Turn order for combat",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CombatantDto"
            }
          },
          "currentTurnIndex": {
            "type": "number",
            "description": "Index of current turn in turnOrder"
          },
          "roundNumber": {
            "type": "number",
            "description": "Current round number"
          },
          "narrative": {
            "type": "string",
            "description": "Narrative summary of current combat"
          },
          "phase": {
            "type": "string",
            "description": "Current combat phase",
            "enum": [
              "PLAYER_TURN",
              "AWAITING_DAMAGE_ROLL",
              "ENEMY_TURN",
              "COMBAT_ENDED"
            ]
          },
          "actionRemaining": {
            "type": "number",
            "description": "Remaining standard actions for current activation"
          },
          "actionMax": {
            "type": "number",
            "description": "Maximum standard actions per activation"
          },
          "bonusActionRemaining": {
            "type": "number",
            "description": "Remaining bonus actions for current activation"
          },
          "bonusActionMax": {
            "type": "number",
            "description": "Maximum bonus actions per activation"
          }
        },
        "required": [
          "characterId",
          "inCombat",
          "enemies",
          "player",
          "turnOrder",
          "currentTurnIndex",
          "roundNumber"
        ]
      },
      "AttackRequestDto": {
        "type": "object",
        "properties": {
          "targetId": {
            "type": "string",
            "description": "Target ID to attack"
          }
        },
        "required": [
          "targetId"
        ]
      },
      "DiceResultDto": {
        "type": "object",
        "properties": {
          "rolls": {
            "description": "Individual dice roll results",
            "type": "array",
            "items": {
              "type": "number"
            }
          },
          "modifierValue": {
            "type": "number",
            "description": "Modifier applied to the total"
          },
          "total": {
            "type": "number",
            "description": "Total result (sum of rolls + modifier)"
          }
        },
        "required": [
          "rolls",
          "modifierValue",
          "total"
        ]
      },
      "CombatDiceResultDto": {
        "type": "object",
        "properties": {
          "rolls": {
            "description": "Individual dice roll results",
            "type": "array",
            "items": {
              "type": "number"
            }
          },
          "modifierValue": {
            "type": "number",
            "description": "Modifier applied to the total"
          },
          "total": {
            "type": "number",
            "description": "Total result (sum of rolls + modifier)"
          },
          "damageTotal": {
            "type": "number",
            "description": "Total damage dealt by the roll"
          },
          "isCrit": {
            "type": "boolean",
            "description": "Whether this damage roll was a critical hit"
          }
        },
        "required": [
          "rolls",
          "modifierValue",
          "total"
        ]
      },
      "CombatEndDto": {
        "type": "object",
        "properties": {
          "victory": {
            "type": "boolean",
            "description": "Victory state"
          },
          "xp_gained": {
            "type": "number",
            "description": "XP gained"
          },
          "player_hp": {
            "type": "number",
            "description": "Player's HP at the end"
          },
          "enemies_defeated": {
            "description": "Enemies that were defeated",
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "fled": {
            "type": "boolean",
            "description": "Flee indicator"
          },
          "narrative": {
            "type": "string",
            "description": "Narrative summary"
          }
        },
        "required": [
          "victory",
          "xp_gained",
          "player_hp",
          "enemies_defeated",
          "narrative"
        ]
      },
      "AttackResponseDto": {
        "type": "object",
        "properties": {
          "diceResult": {
            "description": "Result of the hit roll for frontend display purposes.",
            "allOf": [
              {
                "$ref": "#/components/schemas/DiceResultDto"
              }
            ]
          },
          "damageDiceResult": {
            "description": "Damage roll result (includes isCrit and damageTotal), present when an attack hits.",
            "allOf": [
              {
                "$ref": "#/components/schemas/CombatDiceResultDto"
              }
            ]
          },
          "damageTotal": {
            "type": "number",
            "description": "Total numeric damage applied to the target (includes damage bonus, doubled on crit if applicable)."
          },
          "isCrit": {
            "type": "boolean",
            "description": "Whether the hit was a critical strike."
          },
          "combatState": {
            "description": "Returns the state of the combat",
            "allOf": [
              {
                "$ref": "#/components/schemas/CombatStateDto"
              }
            ]
          },
          "combatEnd": {
            "description": "Combat end information (present when combat ends due to this attack)",
            "allOf": [
              {
                "$ref": "#/components/schemas/CombatEndDto"
              }
            ]
          }
        },
        "required": [
          "combatState"
        ]
      },
      "EnemyAttackLogDto": {
        "type": "object",
        "properties": {
          "attackerId": {
            "type": "string",
            "description": "ID of the attacking enemy",
            "example": "goblin-1"
          },
          "attackerName": {
            "type": "string",
            "description": "Name of the attacking enemy",
            "example": "Goblin"
          },
          "targetId": {
            "type": "string",
            "description": "ID of the target (player characterId)",
            "example": "char-123"
          },
          "hit": {
            "type": "boolean",
            "description": "Whether the attack hit the target",
            "example": true
          },
          "attackRoll": {
            "description": "Attack roll result",
            "allOf": [
              {
                "$ref": "#/components/schemas/DiceResultDto"
              }
            ]
          },
          "damageRoll": {
            "description": "Damage roll result (only present if hit)",
            "allOf": [
              {
                "$ref": "#/components/schemas/CombatDiceResultDto"
              }
            ]
          },
          "damageTotal": {
            "type": "number",
            "description": "Total damage dealt (0 if miss)",
            "example": 5
          },
          "isCrit": {
            "type": "boolean",
            "description": "Whether the attack was a critical hit",
            "example": false
          }
        },
        "required": [
          "attackerId",
          "attackerName",
          "targetId",
          "hit"
        ]
      },
      "EndPlayerTurnResponseDto": {
        "type": "object",
        "properties": {
          "roundNumber": {
            "type": "number",
            "description": "The current round number after enemy turn",
            "example": 2
          },
          "attackLogs": {
            "description": "List of enemy attack logs in execution order",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/EnemyAttackLogDto"
            }
          },
          "totalDamageToPlayer": {
            "type": "number",
            "description": "Total damage dealt to the player this turn",
            "example": 12
          },
          "playerDefeated": {
            "type": "boolean",
            "description": "Whether the player was defeated this turn",
            "example": false
          },
          "combatState": {
            "description": "Updated combat state after all enemy actions",
            "allOf": [
              {
                "$ref": "#/components/schemas/CombatStateDto"
              }
            ]
          }
        },
        "required": [
          "roundNumber",
          "attackLogs",
          "totalDamageToPlayer",
          "combatState"
        ]
      },
      "CombatEndResultDto": {
        "type": "object",
        "properties": {
          "combat_end": {
            "description": "Combat end information",
            "allOf": [
              {
                "$ref": "#/components/schemas/CombatEndDto"
              }
            ]
          }
        },
        "required": [
          "combat_end"
        ]
      },
      "CombatEndResponseDto": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "description": "Whether the operation succeeded"
          },
          "message": {
            "type": "string",
            "description": "Human readable message"
          },
          "instructions": {
            "description": "Optional instructions returned after ending combat",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CombatEndResultDto"
            }
          }
        },
        "required": [
          "success",
          "message"
        ]
      },
      "DiceRequestDto": {
        "type": "object",
        "properties": {
          "expr": {
            "type": "string"
          },
          "advantage": {
            "type": "string"
          }
        },
        "required": [
          "expr"
        ]
      },
      "ImageRequestDto": {
        "type": "object",
        "properties": {
          "token": {
            "type": "string",
            "description": "API token (optional)"
          },
          "prompt": {
            "type": "string",
            "description": "Image prompt"
          },
          "model": {
            "type": "string",
            "description": "Model to use"
          }
        },
        "required": [
          "prompt"
        ]
      },
      "CharacterIdBodyDto": {
        "type": "object",
        "properties": {
          "characterId": {
            "type": "string",
            "description": "UUID of the character"
          }
        },
        "required": [
          "characterId"
        ]
      },
      "AvatarResponseDto": {
        "type": "object",
        "properties": {
          "imageUrl": {
            "type": "string",
            "description": "Generated avatar image URL or base64 data"
          }
        },
        "required": [
          "imageUrl"
        ]
      },
      "UseItemRequestDto": {
        "type": "object",
        "properties": {
          "itemId": {
            "type": "string",
            "description": "The inventory item _id to use",
            "example": "abc123-def456"
          }
        },
        "required": [
          "itemId"
        ]
      },
      "Function": {
        "type": "object",
        "properties": {}
      },
      "UseItemResponseDto": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "description": "Whether the item was successfully used"
          },
          "healAmount": {
            "type": "number",
            "description": "Amount healed (if applicable)"
          },
          "combatState": {
            "description": "Updated combat state (if in combat)",
            "allOf": [
              {
                "$ref": "#/components/schemas/Function"
              }
            ]
          },
          "character": {
            "description": "Updated character (if not in combat)",
            "allOf": [
              {
                "$ref": "#/components/schemas/Function"
              }
            ]
          },
          "message": {
            "type": "string",
            "description": "Human-readable result message"
          }
        },
        "required": [
          "success",
          "message"
        ]
      },
      "SubmitRollDto": {
        "type": "object",
        "properties": {
          "instructions": {
            "description": "Resolved instructions array",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/RollInstructionMessageDto"
            }
          }
        },
        "required": [
          "instructions"
        ]
      }
    }
  }
}