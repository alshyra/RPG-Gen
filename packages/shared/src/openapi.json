{
  "openapi": "3.0.0",
  "paths": {
    "/api/auth/google": {
      "get": {
        "operationId": "AuthController_googleAuth",
        "parameters": [],
        "responses": {
          "200": {
            "description": ""
          }
        },
        "summary": "Initiate Google OAuth login",
        "tags": [
          "auth"
        ]
      }
    },
    "/api/auth/google/callback": {
      "get": {
        "operationId": "AuthController_googleAuthRedirect",
        "parameters": [],
        "responses": {
          "200": {
            "description": ""
          }
        },
        "summary": "Google OAuth callback",
        "tags": [
          "auth"
        ]
      }
    },
    "/api/auth/profile": {
      "get": {
        "operationId": "AuthController_getProfile",
        "parameters": [],
        "responses": {
          "200": {
            "description": "List of characters",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthProfileDto"
                }
              }
            }
          }
        },
        "summary": "Get current user profile",
        "tags": [
          "auth"
        ]
      }
    },
    "/api/auth/logout": {
      "get": {
        "operationId": "AuthController_logout",
        "parameters": [],
        "responses": {
          "200": {
            "description": ""
          }
        },
        "summary": "Logout (client should clear token)",
        "tags": [
          "auth"
        ]
      }
    },
    "/api/chat/{characterId}": {
      "post": {
        "operationId": "ChatController_chat",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ChatRequestDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Chat response with narrative and instructions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ChatResponseDto"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request"
          },
          "500": {
            "description": "Chat processing failed"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Send prompt to Gemini (chat)",
        "tags": [
          "chat"
        ]
      }
    },
    "/api/chat/{characterId}/history": {
      "get": {
        "operationId": "ChatController_getHistory",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Conversation history",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ChatMessageDto"
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request"
          },
          "500": {
            "description": "History retrieval failed"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Get conversation history for a character",
        "tags": [
          "chat"
        ]
      }
    },
    "/api/characters": {
      "post": {
        "operationId": "CharacterController_create",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateCharacterBodyDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Character created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CharacterResponseDto"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Create a new character",
        "tags": [
          "characters"
        ]
      },
      "get": {
        "operationId": "CharacterController_findAll",
        "parameters": [],
        "responses": {
          "200": {
            "description": "List of characters",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/CharacterResponseDto"
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Get all characters for the current user",
        "tags": [
          "characters"
        ]
      }
    },
    "/api/characters/deceased": {
      "get": {
        "operationId": "CharacterController_getDeceased",
        "parameters": [],
        "responses": {
          "200": {
            "description": "List of deceased characters",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/DeceasedCharacterResponseDto"
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Get all deceased characters",
        "tags": [
          "characters"
        ]
      }
    },
    "/api/characters/{characterId}": {
      "get": {
        "operationId": "CharacterController_findOne",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Character found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CharacterResponseDto"
                }
              }
            }
          },
          "404": {
            "description": "Character not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Get a specific character by ID",
        "tags": [
          "characters"
        ]
      },
      "put": {
        "operationId": "CharacterController_update",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "description": "ID of the character to update",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "description": "Fields to update",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CharacterResponseDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Character updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CharacterResponseDto"
                }
              }
            }
          },
          "404": {
            "description": "Character not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Update a character",
        "tags": [
          "characters"
        ]
      },
      "delete": {
        "operationId": "CharacterController_delete",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Character deleted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MessageResponseDto"
                }
              }
            }
          },
          "404": {
            "description": "Character not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Delete a character",
        "tags": [
          "characters"
        ]
      }
    },
    "/api/characters/{characterId}/kill": {
      "post": {
        "operationId": "CharacterController_kill",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/KillCharacterBodyDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Character marked as deceased",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CharacterResponseDto"
                }
              }
            }
          },
          "404": {
            "description": "Character not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Mark a character as deceased",
        "tags": [
          "characters"
        ]
      }
    },
    "/api/characters/{characterId}/inventory": {
      "post": {
        "operationId": "CharacterController_addInventory",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateInventoryItemDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Item added to inventory",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CharacterResponseDto"
                }
              }
            }
          },
          "404": {
            "description": "Character not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Add an item to character's inventory",
        "tags": [
          "characters"
        ]
      }
    },
    "/api/characters/{characterId}/inventory/{itemId}": {
      "patch": {
        "operationId": "CharacterController_updateInventory",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "itemId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateInventoryItemDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Inventory item updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CharacterResponseDto"
                }
              }
            }
          },
          "404": {
            "description": "Character or item not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Update an item in character's inventory",
        "tags": [
          "characters"
        ]
      },
      "delete": {
        "operationId": "CharacterController_removeInventory",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "itemId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RemoveInventoryBodyDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Item removed from inventory",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CharacterResponseDto"
                }
              }
            }
          },
          "404": {
            "description": "Character or item not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Remove an item from character's inventory",
        "tags": [
          "characters"
        ]
      }
    },
    "/api/characters/{characterId}/inspiration/grant": {
      "post": {
        "operationId": "CharacterController_grantInspiration",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/GrantInspirationBodyDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Inspiration granted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/InspirationResponseDto"
                }
              }
            }
          },
          "400": {
            "description": "Invalid amount"
          },
          "404": {
            "description": "Character not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Grant inspiration point(s) to a character",
        "tags": [
          "characters"
        ]
      }
    },
    "/api/characters/{characterId}/inspiration/spend": {
      "post": {
        "operationId": "CharacterController_spendInspiration",
        "parameters": [
          {
            "name": "characterId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "201": {
            "description": "Inspiration spent",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/InspirationResponseDto"
                }
              }
            }
          },
          "400": {
            "description": "No inspiration points available"
          },
          "404": {
            "description": "Character not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Spend an inspiration point",
        "tags": [
          "characters"
        ]
      }
    },
    "/api/items": {
      "get": {
        "operationId": "ItemDefinitionController_list",
        "parameters": [],
        "responses": {
          "200": {
            "description": ""
          }
        },
        "tags": [
          "ItemDefinition"
        ]
      }
    },
    "/api/items/{definitionId}": {
      "get": {
        "operationId": "ItemDefinitionController_get",
        "parameters": [
          {
            "name": "definitionId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": ""
          }
        },
        "tags": [
          "ItemDefinition"
        ]
      }
    },
    "/api/dice": {
      "post": {
        "operationId": "DiceController_roll",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DiceRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Dice throw result",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DiceThrowDto"
                }
              }
            }
          },
          "400": {
            "description": "Invalid dice expression"
          }
        },
        "summary": "Roll dice expression like 1d6+2, optionally with advantage/disadvantage for d20",
        "tags": [
          "dice"
        ]
      }
    },
    "/api/image": {
      "post": {
        "operationId": "ImageController_generate",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ImageRequestDto"
              }
            }
          }
        },
        "responses": {
          "400": {
            "description": "Image generation not implemented"
          }
        },
        "summary": "Generate image from prompt",
        "tags": [
          "image"
        ]
      }
    },
    "/api/image/generate-avatar": {
      "post": {
        "operationId": "ImageController_generateAvatar",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CharacterIdBodyDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Avatar generated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AvatarResponseDto"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request or avatar generation failed"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Generate character avatar from description",
        "tags": [
          "image"
        ]
      }
    },
    "/api/health": {
      "get": {
        "operationId": "HealthController_getHealth",
        "parameters": [],
        "responses": {
          "200": {
            "description": ""
          }
        },
        "tags": [
          "Health"
        ]
      }
    }
  },
  "info": {
    "title": "RPG Gemini Portal",
    "description": "Prototype API for RPG portal using Gemini tokens",
    "version": "0.1",
    "contact": {}
  },
  "tags": [],
  "servers": [],
  "components": {
    "securitySchemes": {
      "bearer": {
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "type": "http"
      }
    },
    "schemas": {
      "AuthProfileDto": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "Id de l'utilisateur"
          },
          "email": {
            "type": "string",
            "description": "Email de l'utilisateur"
          },
          "displayName": {
            "type": "string",
            "description": "Nom affich√© de l'utilisateur"
          },
          "picture": {
            "type": "string",
            "description": "URL de la photo de profil de l'utilisateur"
          }
        },
        "required": [
          "id",
          "email",
          "displayName",
          "picture"
        ]
      },
      "ChatRequestDto": {
        "type": "object",
        "properties": {
          "message": {
            "type": "string",
            "description": "User message to send to the AI"
          }
        },
        "required": [
          "message"
        ]
      },
      "RollInstructionDto": {
        "type": "object",
        "properties": {
          "dices": {
            "type": "string",
            "description": "Dice expression (e.g., 1d20+5)"
          },
          "modifier": {
            "type": "object",
            "description": "Modifier"
          },
          "description": {
            "type": "string",
            "description": "Roll description"
          },
          "advantage": {
            "type": "string",
            "description": "Advantage type",
            "enum": [
              "advantage",
              "disadvantage",
              "none"
            ]
          }
        },
        "required": [
          "dices"
        ]
      },
      "SpellInstructionDataDto": {
        "type": "object",
        "properties": {
          "action": {
            "type": "string",
            "description": "Spell action",
            "enum": [
              "learn",
              "cast",
              "forget"
            ]
          },
          "name": {
            "type": "string",
            "description": "Spell name"
          },
          "level": {
            "type": "number",
            "description": "Spell level"
          },
          "school": {
            "type": "string",
            "description": "Spell school"
          },
          "description": {
            "type": "string",
            "description": "Spell description"
          }
        },
        "required": [
          "action",
          "name"
        ]
      },
      "InventoryInstructionDataDto": {
        "type": "object",
        "properties": {
          "action": {
            "type": "string",
            "description": "Inventory action",
            "enum": [
              "add",
              "remove",
              "use"
            ]
          },
          "name": {
            "type": "string",
            "description": "Item name"
          },
          "quantity": {
            "type": "number",
            "description": "Quantity"
          },
          "description": {
            "type": "string",
            "description": "Item description"
          }
        },
        "required": [
          "action",
          "name"
        ]
      },
      "GameInstructionDto": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "description": "Instruction type",
            "enum": [
              "roll",
              "xp",
              "hp",
              "spell",
              "inventory"
            ]
          },
          "roll": {
            "description": "Roll instruction data",
            "allOf": [
              {
                "$ref": "#/components/schemas/RollInstructionDto"
              }
            ]
          },
          "hp": {
            "type": "number",
            "description": "HP change"
          },
          "xp": {
            "type": "number",
            "description": "XP gained"
          },
          "spell": {
            "description": "Spell instruction",
            "allOf": [
              {
                "$ref": "#/components/schemas/SpellInstructionDataDto"
              }
            ]
          },
          "inventory": {
            "description": "Inventory instruction",
            "allOf": [
              {
                "$ref": "#/components/schemas/InventoryInstructionDataDto"
              }
            ]
          }
        }
      },
      "ChatResponseDto": {
        "type": "object",
        "properties": {
          "text": {
            "type": "string",
            "description": "Narrative text from the AI (cleaned)"
          },
          "instructions": {
            "description": "Game instructions extracted from the response",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/GameInstructionDto"
            }
          },
          "model": {
            "type": "string",
            "description": "AI model used"
          },
          "usage": {
            "type": "object",
            "description": "Token usage statistics",
            "additionalProperties": true
          },
          "raw": {
            "type": "object",
            "description": "Raw response (null by default)"
          }
        },
        "required": [
          "text",
          "instructions",
          "model"
        ]
      },
      "MessageMetaDto": {
        "type": "object",
        "properties": {
          "model": {
            "type": "string",
            "description": "AI model version used"
          },
          "usage": {
            "type": "object",
            "description": "Token usage statistics",
            "additionalProperties": true
          }
        }
      },
      "ChatMessageDto": {
        "type": "object",
        "properties": {
          "role": {
            "type": "string",
            "description": "Message role",
            "enum": [
              "user",
              "assistant",
              "system"
            ]
          },
          "text": {
            "type": "string",
            "description": "Message text content"
          },
          "timestamp": {
            "type": "number",
            "description": "Unix timestamp of the message"
          },
          "meta": {
            "description": "Message metadata",
            "allOf": [
              {
                "$ref": "#/components/schemas/MessageMetaDto"
              }
            ]
          },
          "narrative": {
            "type": "string",
            "description": "Narrative text (for assistant messages)"
          },
          "instructions": {
            "description": "Game instructions (for assistant messages)",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/GameInstructionDto"
            }
          }
        },
        "required": [
          "role",
          "text",
          "timestamp"
        ]
      },
      "CreateCharacterBodyDto": {
        "type": "object",
        "properties": {
          "world": {
            "type": "string",
            "description": "Game world (e.g., dnd, vtm)"
          }
        },
        "required": [
          "world"
        ]
      },
      "RaceResponseDto": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "Race ID"
          },
          "name": {
            "type": "string",
            "description": "Race name"
          },
          "mods": {
            "type": "object",
            "description": "Ability score modifiers",
            "additionalProperties": {
              "type": "number"
            }
          }
        },
        "required": [
          "mods"
        ]
      },
      "AbilityScoresResponseDto": {
        "type": "object",
        "properties": {
          "Str": {
            "type": "number",
            "description": "Strength score"
          },
          "Dex": {
            "type": "number",
            "description": "Dexterity score"
          },
          "Con": {
            "type": "number",
            "description": "Constitution score"
          },
          "Int": {
            "type": "number",
            "description": "Intelligence score"
          },
          "Wis": {
            "type": "number",
            "description": "Wisdom score"
          },
          "Cha": {
            "type": "number",
            "description": "Charisma score"
          }
        }
      },
      "CharacterClassResponseDto": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Class name"
          },
          "level": {
            "type": "number",
            "description": "Class level"
          }
        }
      },
      "SkillResponseDto": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Skill name"
          },
          "proficient": {
            "type": "boolean",
            "description": "Is proficient in this skill"
          },
          "modifier": {
            "type": "number",
            "description": "Skill modifier"
          }
        }
      },
      "ItemResponseDto": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "description": "Item ID"
          },
          "definitionId": {
            "type": "string",
            "description": "Definition ID"
          },
          "name": {
            "type": "string",
            "description": "Item name"
          },
          "qty": {
            "type": "number",
            "description": "Quantity"
          },
          "description": {
            "type": "string",
            "description": "Item description"
          },
          "equipped": {
            "type": "boolean",
            "description": "Is equipped"
          },
          "meta": {
            "type": "object",
            "description": "Item metadata",
            "additionalProperties": true
          }
        }
      },
      "SpellResponseDto": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Spell name"
          },
          "level": {
            "type": "number",
            "description": "Spell level"
          },
          "description": {
            "type": "string",
            "description": "Spell description"
          },
          "meta": {
            "type": "object",
            "description": "Spell metadata",
            "additionalProperties": true
          }
        },
        "required": [
          "name"
        ]
      },
      "CharacterResponseDto": {
        "type": "object",
        "properties": {
          "characterId": {
            "type": "string",
            "description": "Unique character ID (UUID)"
          },
          "name": {
            "type": "string",
            "description": "Character name"
          },
          "physicalDescription": {
            "type": "string",
            "description": "Physical description of the character"
          },
          "race": {
            "description": "Character race",
            "allOf": [
              {
                "$ref": "#/components/schemas/RaceResponseDto"
              }
            ]
          },
          "scores": {
            "description": "Ability scores",
            "allOf": [
              {
                "$ref": "#/components/schemas/AbilityScoresResponseDto"
              }
            ]
          },
          "hp": {
            "type": "number",
            "description": "Current hit points"
          },
          "hpMax": {
            "type": "number",
            "description": "Maximum hit points"
          },
          "totalXp": {
            "type": "number",
            "description": "Total experience points"
          },
          "classes": {
            "description": "Character classes",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CharacterClassResponseDto"
            }
          },
          "skills": {
            "description": "Character skills",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SkillResponseDto"
            }
          },
          "world": {
            "type": "string",
            "description": "Game world (e.g., dnd, vtm)"
          },
          "portrait": {
            "type": "string",
            "description": "Character portrait URL or base64"
          },
          "gender": {
            "type": "string",
            "description": "Character gender"
          },
          "proficiency": {
            "type": "number",
            "description": "Proficiency bonus"
          },
          "inspirationPoints": {
            "type": "number",
            "description": "Inspiration points"
          },
          "isDeceased": {
            "type": "boolean",
            "description": "Whether character is deceased"
          },
          "diedAt": {
            "format": "date-time",
            "type": "string",
            "description": "Date of death (ISO string)"
          },
          "deathLocation": {
            "type": "string",
            "description": "Location where character died"
          },
          "state": {
            "type": "string",
            "description": "Character state",
            "enum": [
              "draft",
              "created"
            ]
          },
          "inventory": {
            "description": "Character inventory",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ItemResponseDto"
            }
          },
          "spells": {
            "description": "Character spells",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SpellResponseDto"
            }
          }
        },
        "required": [
          "characterId",
          "world",
          "portrait",
          "isDeceased",
          "state"
        ]
      },
      "DeceasedCharacterResponseDto": {
        "type": "object",
        "properties": {
          "characterId": {
            "type": "string",
            "description": "Unique character ID (UUID)"
          },
          "name": {
            "type": "string",
            "description": "Character name"
          },
          "physicalDescription": {
            "type": "string",
            "description": "Physical description of the character"
          },
          "race": {
            "description": "Character race",
            "allOf": [
              {
                "$ref": "#/components/schemas/RaceResponseDto"
              }
            ]
          },
          "scores": {
            "description": "Ability scores",
            "allOf": [
              {
                "$ref": "#/components/schemas/AbilityScoresResponseDto"
              }
            ]
          },
          "hp": {
            "type": "number",
            "description": "Current hit points"
          },
          "hpMax": {
            "type": "number",
            "description": "Maximum hit points"
          },
          "totalXp": {
            "type": "number",
            "description": "Total experience points"
          },
          "classes": {
            "description": "Character classes",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CharacterClassResponseDto"
            }
          },
          "skills": {
            "description": "Character skills",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SkillResponseDto"
            }
          },
          "world": {
            "type": "string",
            "description": "Game world (e.g., dnd, vtm)"
          },
          "portrait": {
            "type": "string",
            "description": "Character portrait URL or base64"
          },
          "gender": {
            "type": "string",
            "description": "Character gender"
          },
          "proficiency": {
            "type": "number",
            "description": "Proficiency bonus"
          },
          "inspirationPoints": {
            "type": "number",
            "description": "Inspiration points"
          },
          "isDeceased": {
            "type": "boolean",
            "description": "Whether character is deceased"
          },
          "diedAt": {
            "type": "string",
            "description": "Date of death (ISO string)"
          },
          "deathLocation": {
            "type": "string",
            "description": "Location where character died"
          },
          "state": {
            "type": "string",
            "description": "Character state",
            "enum": [
              "draft",
              "created"
            ]
          },
          "inventory": {
            "description": "Character inventory",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ItemResponseDto"
            }
          },
          "spells": {
            "description": "Character spells",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SpellResponseDto"
            }
          }
        },
        "required": [
          "characterId",
          "world",
          "portrait",
          "isDeceased",
          "state"
        ]
      },
      "MessageResponseDto": {
        "type": "object",
        "properties": {
          "message": {
            "type": "string",
            "description": "Response message"
          }
        },
        "required": [
          "message"
        ]
      },
      "KillCharacterBodyDto": {
        "type": "object",
        "properties": {
          "deathLocation": {
            "type": "string",
            "description": "Location where character died"
          }
        }
      },
      "CreateInventoryItemDto": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "description": "Inventory item id (UUID). If provided, attempt to merge with existing item"
          },
          "definitionId": {
            "type": "string",
            "description": "Canonical definition id for this item"
          },
          "name": {
            "type": "string",
            "description": "Name for this inventory item"
          },
          "qty": {
            "type": "number",
            "description": "Quantity for this item"
          },
          "description": {
            "type": "string",
            "description": "Item description / notes"
          },
          "equipped": {
            "type": "boolean",
            "description": "If true this item is equipped"
          },
          "meta": {
            "type": "object",
            "description": "Arbitrary item meta"
          }
        },
        "required": [
          "definitionId"
        ]
      },
      "RemoveInventoryBodyDto": {
        "type": "object",
        "properties": {
          "qty": {
            "type": "number",
            "description": "Quantity to remove (0 = remove all)"
          }
        }
      },
      "GrantInspirationBodyDto": {
        "type": "object",
        "properties": {
          "amount": {
            "type": "number",
            "description": "Amount of inspiration to grant (1-5)",
            "default": 1
          }
        }
      },
      "InspirationResponseDto": {
        "type": "object",
        "properties": {
          "ok": {
            "type": "boolean",
            "description": "Operation success status"
          },
          "inspirationPoints": {
            "type": "number",
            "description": "Updated inspiration points count"
          },
          "character": {
            "description": "Updated character",
            "allOf": [
              {
                "$ref": "#/components/schemas/CharacterResponseDto"
              }
            ]
          }
        },
        "required": [
          "ok",
          "inspirationPoints",
          "character"
        ]
      },
      "DiceRequest": {
        "type": "object",
        "properties": {
          "expr": {
            "type": "string",
            "description": "Dice expression (e.g., 1d20+5, 2d6, 1d8-2)"
          },
          "advantage": {
            "type": "string",
            "description": "Advantage type for d20 rolls",
            "enum": [
              "advantage",
              "disadvantage",
              "none"
            ]
          }
        },
        "required": [
          "expr"
        ]
      },
      "DiceThrowDto": {
        "type": "object",
        "properties": {
          "rolls": {
            "description": "Individual dice roll results",
            "type": "array",
            "items": {
              "type": "number"
            }
          },
          "mod": {
            "type": "number",
            "description": "Modifier applied to the total"
          },
          "total": {
            "type": "number",
            "description": "Total result (sum of rolls + modifier)"
          },
          "advantage": {
            "type": "string",
            "description": "Advantage type used for this roll",
            "enum": [
              "advantage",
              "disadvantage",
              "none"
            ]
          },
          "keptRoll": {
            "type": "number",
            "description": "The roll that was kept (when using advantage/disadvantage)"
          },
          "discardedRoll": {
            "type": "number",
            "description": "The roll that was discarded (when using advantage/disadvantage)"
          }
        },
        "required": [
          "rolls",
          "mod",
          "total"
        ]
      },
      "ImageRequestDto": {
        "type": "object",
        "properties": {
          "token": {
            "type": "string",
            "description": "API token (optional)"
          },
          "prompt": {
            "type": "string",
            "description": "Image prompt"
          },
          "model": {
            "type": "string",
            "description": "Model to use"
          }
        },
        "required": [
          "prompt"
        ]
      },
      "CharacterIdBodyDto": {
        "type": "object",
        "properties": {
          "characterId": {
            "type": "string",
            "description": "UUID of the character"
          }
        },
        "required": [
          "characterId"
        ]
      },
      "AvatarResponseDto": {
        "type": "object",
        "properties": {
          "imageUrl": {
            "type": "string",
            "description": "Generated avatar image URL or base64 data"
          }
        },
        "required": [
          "imageUrl"
        ]
      }
    }
  }
}